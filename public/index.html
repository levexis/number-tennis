<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" href="css/flexible.css">
<link rel="stylesheet" href="css/numten.css">
<script src="js/vendor/jquery-min.js"></script>
<script src="js/vendor/underscore-min.js"></script>
  <head>
    <meta charset=utf-8>
    <title>Tom & Paul's Number Tennis</title>
    <!--[if IE]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js">
      </script>
    <![endif]-->
  </head>
  <body>
<!--    <div id="nav" class="nav clearfix"> 
      <ul> 
        <li>home</li>
        <li>options</li>
        <li>how to play</li>
     </ul>
    </div>-->
    <h1>Number Tennis - TARGET: <span id="target">10</span></h1>
<!--    <div id="instructions">
        Instuctions
    </div>
    <div id="options">
        <div id="sound">Sound</div>
        <div id="difficulty">Difficulty</div>
    </div> !-->
    <div id="service" class="ball serve">start</div>
    <div id="answers">
        <div id="answer1" class="answer">&nbsp;</div>
        <div id="answer2" class="answer">&nbsp;</div>
        <div id="answer3" class="answer">&nbsp;</div>
        <div id="answer4" class="answer">&nbsp;</div>
        <div id="answer5" class="answer">&nbsp;</div>
    </div>
    <div class="score" id="scoreboard">score: <span id="score">0</span> / <span id="games">0</span></div> 
    <footer>
      <p>Copyight 2014 Thomas JM Cook</p>
    </footer>
  </body>	
</html>
<script>
$(document).ready(function(){
    var firstTime = true;
    // gets a number between 1 and max
    function randy( max ) {
        return Math.ceil( Math.random() * max );
    }
    function generateChoices (serve,target,options) {
        options = options || 3;            
        var choice,
            crashTest = 0,
            out = [];
            correct = randy ( options ) ; // which one will be correct
        for ( var i=1; i<=options ;i++) {
            if ( i === correct ) { 
                out.push ( target - serve);
            } else {
                // spread could be effected by difficulty, ie maybe 1 difference?
                choice = randy ( target );
                while ( isAnswerCorrect ( choice , serve, target ) && crashTest++ < 50 ) { 
                    choice = randy ( target );
                }
                out.push ( choice ); 
            }
        }
        return out;    
    }
    
    function isAnswerCorrect ( answer , serve, target ) {

        if ( ( answer + serve) === target ) {
            return true;
        } else {
            return false;
        }

    }

    $('#target').click( function (e) {
        e.currentTarget.innerHTML = randy (100)+'' ;
    });

    $('#service').click( function (e) {
        var target = $('#target').text() *1 
            serve = randy ( target ),
            games = ( $('#games').text() ) * 1,
            choices= generateChoices ( serve, target, 5 ),
            i=1;
        _.each ( choices, function ( choice ) {
            $('#answer' + i).text(choice);
            i++;
        });
        $('#service').text(serve);
        // could set a timeout here ot a countdown 
        if ( firstTime ) {
            firstTime = false;
        } else {
            games = games + 1
        }
        $('#games').text(games);        
    });

    $('.answer').click( function (e) {
        var answer = e.currentTarget.innerHTML * 1,
            target = $('#target').text() *1, 
            serve = $('#service').text() *1, 
            score = $('#score').text() *1;
        
        if ( isAnswerCorrect ( answer , serve , target ) ) {
            $('#score').text( score + 1 );
            $('#scoreboard').css('background', 'green');            
            $('#service').css('background', 'green');
            // could increment target or randomise it!
            $('#target').text( target + 1 );
        } else {
            $('#scoreboard').css('background', 'red');
            $('#service').css('background', 'red');            
        }

        // increment games and serve again
        $('#service').click();
    });
})



</script>